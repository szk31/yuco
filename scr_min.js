var memcount_rep_int,auto_display_max,longpress_timer,post_longpress_timer,reb_display_inter,series_lookup={マクロス:["マクロス","まくろす"],ラブライブ:["ラブライブ","らぶらいぶ","LL","ll"],アイマス:["アイマス","あいます","デレマス","でれます"],ジブリ:["ジブリ","じぶり"],物語シリーズ:["物語シリーズ","ものがたりしりーず","ものがたりシリーズ"],まどマギ:["まどマギ","まどまぎ","まどか"],disney:["disney","ディズニー","でぃずにー","Disney"]},entry_idx={song_id:0,video:1,note:2,time:3},song_idx={name:0,artist:1,reading:2,attr:3,release:4,reference:5},video_idx={id:0,date:1},version="1.5.8a",prevent_menu_popup=!1,current_page="home",max_display=100,do_display_hidden=!0,do_clear_input=!1,do_random_anyway=!1,do_share_web=!1,entry_proc=[],processed_song_name=[""];function init(){$("#input").val("");{let s=new Date("2021-01-01");function t(t){var r=new Date(s);return r.setDate(s.getDate()+t),r.toISOString().slice(0,10)}for(var r in video)video[r][video_idx.date]=t(video[r][video_idx.date]);for(var r in entry)entry[r][entry_idx.note]=note_index[entry[r][entry_idx.note]];note_index=null}for(var r in song)entry_proc[r]=[];for(var r=0;r<entry.length;++r)entry_proc[entry[r][0]].push(r);$("#info_version").html(version),$("#info_last-update").html(video[video.length-1][video_idx.date]),auto_display_max=Math.floor(5*Math.pow(window.innerHeight/window.innerWidth,1.41421356237));for(var r=1;r<song.length;++r)processed_song_name.push(song[r][song_idx.name].toLowerCase().normalize("NFKC"))}function memcount_load_rep(){clearInterval(memcount_rep_int)}function display_date(s){var t="string"==typeof s?new Date(s):s;return t.getFullYear()+"-"+fill_digit(t.getMonth()+1,2)+"-"+fill_digit(t.getDate(),2)}function fill_digit(s,t){for(e=""+s;e.length<t;)e="0"+e;return e}function is_private(s){return entry[s][entry_idx.note].includes("非公開")||entry[s][entry_idx.note].includes("記録用")||entry[s][entry_idx.note].includes("アーカイブなし")}function bold(s,t){var r=s.toLowerCase().indexOf(t.toLowerCase());return -1===r||""===t?s:s.substring(0,r)+"<b>"+s.substring(r,r+t.length)+"</b>"+s.substring(r+t.length)}function copy_of(s){return"object"==typeof s?JSON.parse(JSON.stringify(s)):s}function get_last_sang(s){return new Date(video[entry[entry_proc[s][entry_proc[s].length-1]][entry_idx.video]][video_idx.date])}function to8601(s){try{return new Date(s.substring(6),parseInt(s.substring(3,5))-1,s.substring(0,2))}catch{return console.log(s+" is not in dd-MM-yyyy format"),-1}}$(window).on("load",async function(){var s=new URLSearchParams(window.location.search);if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));else if(window.innerHeight/window.innerWidth<1.3){$("#v_screen").addClass("post_switch"),$("#v_screen").height("100%"),$("#v_screen").width(.5625*window.innerHeight),$("#v_screen").attr("src","index.html"+window.location.search),$("body > div").addClass("post_switch"),$("body").addClass("post_switch"),s.delete("key"),window.history.replaceState(null,"",0===s.size?"":"?"+s.toString());return}""===getCookie("pcsl_settings_display")?(setCookie("pcsl_settings_display",100),setCookie("pcsl_settings_hidden",1),setCookie("pcsl_settings_clear",0),setCookie("pcsl_settings_random",0),setCookie("pcsl_settings_share",0)):(max_display=parseInt(getCookie("pcsl_settings_display")),do_display_hidden="1"===getCookie("pcsl_settings_hidden"),do_clear_input="1"===getCookie("pcsl_settings_clear"),do_random_anyway="1"===getCookie("pcsl_settings_random"),do_share_web="1"===getCookie("pcsl_settings_share"),$("#search_options_count_input").val(max_display),$("#search_options_btn_displayHidden").toggleClass("selected",do_display_hidden),$("#search_options_btn_reset").toggleClass("selected",do_clear_input),$("#search_options_btn_randomAnyway").toggleClass("selected",do_random_anyway),$("#search_options_btn_shareWeb").toggleClass("selected",do_share_web)),null!==s.get("hfilter")?setCookie("pcsl_settings_hfilter",hard_filter=parseInt(s.get("hfilter")),400):""!==getCookie("pcsl_settings_hfilter")&&(hard_filter=parseInt(getCookie("pcsl_settings_hfilter")),removeCookie("pcsl_settings_hfilter"),setCookie("pcsl_settings_hfilter",hard_filter,400)),init();var t=s.get("page");if("home"!==t&&-1===jump2page(t)&&jump2page("home"),null!==s.get("search")){"search"!==current_page&&jump2page("search");var r=s.get("search").split(",");if(r.length>1){var i=0;for(var n in r){var a=parseInt(r[n]);a>=1&&a<song.length&&(hits[i++]=song_lookup[a])}is_searching_from_rep=1,loading="!bulk_load_flag",update_display(1)}else r>=1&&r<song.length&&($("#input").val(song[song_lookup[r]][song_idx.name]),$("#input").blur())}if(null!==s.get("rfilter")){"repertoire"!==current_page&&jump2page("rep");for(var o=[],a=parseInt(s.get("rfilter")),l=0;a;)a%2&&o.push(l),a>>=1,l++;for(var n in rep_anisong)o.includes(rep_anisong[n][1])||$("#anisong_"+n).click();for(var n in rep_genre)o.includes(rep_genre[n][1])||$("#general_"+n).click()}$("#loading_overlay").addClass("hidden")}),$(function(){$(document).on("click","#nav_menu",function(s){s.preventDefault(),!prevent_menu_popup&&($("#menu_container").toggleClass("hidden"),$("#nav_menu").toggleClass("menu_opened"),$(document.body).toggleClass("no_scroll"))}),$(document).on("click","#nav_to_top",function(s){s.preventDefault(),!prevent_menu_popup&&($("html,body").animate({scrollTop:0},"fast"),"repertoire"===current_page&&rep_display_selected_first&&rep_display())}),$(document).on("click","#menu_container",function(s){$(s.target).parents(".defog").length||$(s.target).hasClass("defog")||($("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))}),$(document).on("click",".menu2page",function(s){var t=$(s.target).attr("id").replace("menu2page_","");t!==current_page&&(jump2page(t),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))}),$(document).on("click","#menu_count",function(){$("#popup_container").removeClass("hidden"),$("#memcount").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0,""===$("#memcount_content").html()&&(memcount_rep_int=setInterval(memcount_load_rep,1))}),$(document).on("click","#menu_info",function(){$("#popup_container").removeClass("hidden"),$("#information").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0}),$(document).on("click","#memcount, #memcount_rep",function(s){$(s.target).closest(".popup_frame").length&&$(".memcount_subblock").toggleClass("hidden")}),$(document).on("click","#popup_container",function(s){$(s.target).closest(".popup_frame").length||$(s.target).find("#rep_list:not(.hidden)").length||($(".popup_frame").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1)}),$(document).on("click",".home_hyperlink_block",function(){jump2page($(this).attr("id").replace("home_hyper_",""))})});var today=new Date().setHours(0,0,0,0);function get_date_different(s,t=today){return Math.round(Math.abs((s="string"==typeof s?new Date(s):s)-(t=void 0===t?t:new Date(t)))/864e5)}function get_sang_count(s){var t=0,r=0;for(var i in entry_proc[s])t++,entry[entry_proc[s][i]][entry_idx.note].includes("【メン限")&&r++;return[t,r]}function get_attr(s){var t=entry[s][entry_idx.note];return t.includes("弾き語り")?"gui":t.includes("アカペラ")?"aca":"oke"}function jump2page(s){switch(current_page=s="rep"===s?"repertoire":s,$(".menu2page_selected").removeClass("menu2page_selected"),$("#menu2page_"+s).addClass("menu2page_selected"),$(".section_container").addClass("hidden"),$("#"+s+"_section").removeClass("hidden"),$("#nav_dummy").addClass("hidden"),$("#nav_search_random").addClass("hidden"),$("#nav_bulk_search").addClass("hidden"),$("#nav_share").addClass("hidden"),$("#search_display").html(""),$("#rep_display").html(""),s){case"home":$("#nav_title").html("ホーム"),$("#nav_dummy").removeClass("hidden");break;case"search":$("#nav_search_random").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!is_searching_from_rep),$("#nav_title").html("曲検索"),$("#input").val(""),search();break;case"rep":case"repertoire":$("#repertoire_section").removeClass("hidden"),$("#nav_bulk_search").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!rep_selected.length),$("#nav_title").html("レパートリー"),rep_input_memory="",rep_search();break;default:return -1}$(window).scrollTop(0)}var copy_popup_is_displaying=!1;function copy_popup(){!copy_popup_is_displaying&&(copy_popup_is_displaying=!0,$("#copy_popup").attr("class","fade_out"),setTimeout(()=>{copy_popup_is_displaying=!1,$("#copy_popup").attr("class","hidden")},1500))}function setCookie(s,t,r=400){let i=new Date;i.setTime(i.getTime()+864e5*r);let n="expires="+i.toUTCString();document.cookie=s+"="+t+";"+n+";path=/"}function getCookie(s){let t=s+"=",r=document.cookie.split(";");for(let i=0;i<r.length;i++){let n=r[i];for(;" "==n.charAt(0);)n=n.substring(1);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return""}function removeCookie(s){document.cookie=s+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/"}var loading="",hide_song=[],searching_song_name=!0,search_sort_by_date=!0,search_sort_asd=!0,is_searching_from_rep=!1;$(function(){$(document).on("click","#nav_search_random",function(){if((!$(this).hasClass("disabled")||do_random_anyway)&&!prevent_menu_popup){var s,t=trial=0;do for(var r in entry_proc[s=Math.floor(Math.random()*song.length)])if(!(!do_display_hidden&&is_private(entry_proc[s][r]))){t++;break}while(0===t);$("#input").val(song[s][song_idx.name]),is_searching_from_rep=0,search()}}),$(document).on("click","#nav_share",function(){if(!("search"!==current_page||$(this).hasClass("disabled"))){for(var s="szk31.github.io/yuco/?search="+song_lookup.indexOf(hits[0]),t=1;t<hits.length;++t)s+=","+song_lookup.indexOf(hits[t]);navigator.clipboard.writeText(s),copy_popup()}}),$(document).on("input","#input",function(){auto_search()}),$(document).on("mousedown",".auto_panel",function(){var s=$(this).attr("id");$("#input").val(s)}),$(document).on("blur","#input",function(){$("#search_auto").addClass("hidden"),is_searching_from_rep?is_searching_from_rep=0:$("#nav_share").toggleClass("disabled",!is_searching_from_rep),search()}),$(document).on("keydown",function(s){13===s.keyCode&&"search"===current_page&&$("#input").blur()}),$(document).on("focus","#input",function(s){(do_clear_input||"!bulk_load_flag"===loading)&&($(s.target).val(""),$("#nav_search_random").removeClass("disabled"),$("#nav_share").addClass("disabled")),auto_search()}),$(document).on("click","#search_options_button",function(){$("#search_options_button").toggleClass("opened"),$("#search_options_container").toggleClass("hidden")}),$(document).on("click",".singer_icon",function(){var s=parseInt($(this).attr("class").split(/\s+/).find(s=>s.startsWith("sing_sel_")).replace("sing_sel_","")),t=part_rom.indexOf(s);0<=t&&t<=2&&(singer_chosen[t]^=1),part_filter[t]^=1,$(".sing_sel_"+s).toggleClass("selected"),loading="",search()}),$(document).on("click",".search_option_group1",function(){var s="songname"===$(this).attr("id").replace(/(search_options_)/,"");s!==searching_song_name&&(searching_song_name=s,$(".search_option_group1>.radio").toggleClass("selected"),$("#input").val(""),$("#nav_share").addClass("disabled"),$("#input").attr("placeholder",searching_song_name?"曲名/読みで検索":"アーティスト名で検索"),$("#search_display").html(""),loading="",$("#nav_search_random").toggleClass("disabled",!searching_song_name))}),$(document).on("click",".search_option_group2",function(){var s="date"===$(this).attr("id").replace(/(search_options_)/,"");search_sort_by_date!==s&&(search_sort_by_date=s,$(".search_option_group2>.radio").toggleClass("selected"),update_display(),$("#search_options_asd>.attr_name").html(search_sort_by_date?search_sort_asd?"古い順&nbsp;(⇌新しい順)":"新しい順&nbsp;(⇌古い順)":search_sort_asd?"正順&nbsp;(⇌逆順)":"逆順&nbsp;(⇌正順)"))}),$(document).on("click",".search_option_group3",function(){search_sort_asd^=1,$("#search_options_asd>.attr_name").html(search_sort_by_date?search_sort_asd?"古い順&nbsp;(⇌新しい順)":"新しい順&nbsp;(⇌古い順)":search_sort_asd?"正順&nbsp;(⇌逆順)":"逆順&nbsp;(⇌正順)"),update_display()}),$(document).on("input","#search_options_count_input",function(){max_count_update(this)}),$(document).on("blur","#search_options_count_input",function(){var s=Math.min(400,Math.max(1,parseInt($("#search_options_count_input").val())));$("#search_options_count_input").val(s),max_display=s,update_display(),setCookie("pcsl_settings_display",s)}),$(document).on("keydown",function(s){13===s.keyCode&&$("#search_options_count_input").blur()}),$(document).on("click",".search_option_group4",function(){var s=$(this).attr("id").replace(/(search_options_)/,"");switch($("#search_options_btn_"+s).toggleClass("selected"),s){case"displayHidden":do_display_hidden^=1,update_display(),setCookie("pcsl_settings_hidden",do_display_hidden?1:0);break;case"reset":setCookie("pcsl_settings_clear",(do_clear_input^=1)?1:0);break;case"randomAnyway":do_random_anyway^=1,$("#nav_search_random").toggleClass("disabled",!searching_song_name||!do_random_anyway&&""!==loading),setCookie("pcsl_settings_random",do_random_anyway?1:0);break;case"shareWeb":do_share_web^=1,setCookie("pcsl_settings_share",do_random_anyway?1:0)}}),$(document).on("click",".song_name_container",function(s){if(!$(s.target).hasClass("song_copy_icon")){var t=parseInt($(this).attr("id"));hide_song.includes(t)?hide_song.splice(hide_song.indexOf(t),1):hide_song.push(t),$(".song_"+t).toggleClass("hidden"),$("#fold_"+t).toggleClass("closed")}}),$(document).on("click",".song_copy_icon",function(){var s=parseInt($(this).attr("id").replace("copy_name_",""));navigator.clipboard.writeText(song[s][song_idx.name]),copy_popup()}),$(document).on("click",".entry_share",function(){var s=parseInt($(this).attr("id").replace("entry_",""));let t="https://www.youtube.com/watch?v="+video[entry[s][entry_idx.video]][video_idx.id];fetch("https://noembed.com/embed?dataType=json&url="+t).then(s=>s.json()).then(function(t){if(void 0===t.title){alert("動画タイトル取得できませんでした。");return}var r="";r=0===entry[s][entry_idx.time]?t.title+"\n(youtu.be/"+video[entry[s][entry_idx.video]][video_idx.id]+")":song[entry[s][entry_idx.song_id]][song_idx.name].trim()+" / "+song[entry[s][entry_idx.song_id]][song_idx.artist]+" @"+t.title+"\n(youtu.be/"+video[entry[s][entry_idx.video]][video_idx.id]+timestamp(s)+")",do_share_web&&(r+="\n\nszk31.github.io/yuco/?search="+song_lookup.indexOf(entry[s][entry_idx.song_id])+"より"),window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(r),"_blank")})})});var hits=[];function auto_search(){var s,t,r,i=$("#input").val().normalize("NFKC").toLowerCase().trim();if(""===i||!searching_song_name){$("#search_auto").addClass("hidden");return}var n=[],a=[],o=0,l=0;for(var d in series_lookup)for(var p in series_lookup[d]){var c=series_lookup[d][p].indexOf(i);if(-1!==c){n[o++]=d;break}}if(/[^\u3040-\u309F\u30FC\u30F4]/.test(i)){for(var d=1;d<song.length;++d)if(!(d>2)||song[d][song_idx.name].trim()!==song[d-1][song_idx.name].trim()){var c=song[d][song_idx.name].toLowerCase().indexOf(i);switch(c){case 0:entry_proc[d].length>0&&(n[o++]=d);break;case -1:break;default:entry_proc[d].length>0&&(a[l++]=d)}if(o>=auto_display_max)break}}else for(var d=1;d<song.length;++d)if(!(d>2)||song[d][song_idx.name].trim()!==song[d-1][song_idx.name].trim()){var c=song[d][song_idx.reading].indexOf(i);switch(c){case 0:entry_proc[d].length>0&&(n[o++]=d);break;case -1:break;default:entry_proc[d].length>0&&(a[l++]=d)}if(o>=auto_display_max)break}var g=0,h="";for(var d in n){if(isNaN(parseInt(n[d])))s="",t=r=n[d];else{var u=song[n[d]][song_idx.reading];s=-1===u.indexOf(" ")?bold(u,i):bold(u.substring(0,u.indexOf(" ")),i),t=bold(r=song[n[d]][song_idx.name],i)}h+='<div id="'+r+'" class="auto_panel'+(0===g?" auto_first":"")+'"><div class="auto_reading">'+s+'</div><div class="auto_display">'+t+"</div></div>",g++}for(var d in a)if(h+='<div id="'+song[a[d]][song_idx.name]+'" class="auto_panel'+(0===g?" auto_first":"")+'"><div class="auto_reading"></div><div class="auto_display">'+bold(song[a[d]][song_idx.name],i)+"</div></div>",++g>=auto_display_max)break;$("#search_auto").html(h),""!==h?$("#search_auto").removeClass("hidden"):$("#search_auto").addClass("hidden")}function search(){if(is_searching_from_rep){update_display();return}var s=$("#input").val().trim();if(s!==loading){if(loading=s,""===s){$("#search_display").html(""),$("#nav_search_random").removeClass("disabled");return}do_random_anyway||$("#nav_search_random").addClass("disabled"),s=s.normalize("NFKC").toLowerCase();var t="";for(var r in series_lookup){for(var i in series_lookup[r])if(series_lookup[r].includes(s)){t=r;break}if(""!==t)break}var n=0;if(""!=t){var a=[2,3,4,7];for(var r in a)if(attr_idx[a[r]]===t){n=a[r];break}}hits=[];for(var r=1;r<song.length&&200!==hits.length;++r)if(searching_song_name){if(""!==t){if(song[r][song_idx.reading].includes(t)){hits.push(r);continue}n&&1<<n&song[r][song_idx.attr]&&hits.push(r)}else(processed_song_name[r].includes(s)||song[r][song_idx.reading].toLowerCase().includes(s))&&hits.push(r)}else song[r][song_idx.artist].toLowerCase().includes(s)&&hits.push(r);$("#nav_share").toggleClass("disabled",searching_song_name||0===hits),hits.sort(function(t,r){return song[t][song_idx.name].trim().toLowerCase()===s?song[r][song_idx.name].trim().toLowerCase()===s?0:-1:song[r][song_idx.name].trim().toLowerCase()===s?1:void 0}),update_display()}}function update_display(s=!1){if(s|=is_searching_from_rep,$("#search_auto").addClass("hidden"),""!==loading||s){for(var t=-1,r=[],i=0,n="",a=0,o=0,l=0;l<hits.length;++l){var d=[];o+=(d=search_sort_by_date?entry_proc[hits[l]].sort((s,t)=>search_sort_asd?s-t:t-s):entry_proc[hits[l]].sort((s,t)=>entry[s][entry_idx.type]===entry[t][entry_idx.type]?s-t:(search_sort_asd?1:-1)*(display_order[entry[s][entry_idx.type]]-display_order[entry[t][entry_idx.type]]))).length;for(var p=0;p<d.length;++p){var c=d[p];if(!(!do_display_hidden&&is_private(c))){if(t!==entry[c][entry_idx.song_id]){n+=(-1!==t?"</div>":"")+'<div class="song_container">',t=entry[c][entry_idx.song_id],r[i++]=t;for(var g=!hide_song.includes(t),h=song[t][song_idx.name].normalize("NFKC"),u=0,v=0;v<h.length;++v)u+=/[ -~]/.test(h.charAt(v))?1:2;"secret base ~君がくれたもの~"===h&&(u=0),"みくみくにしてあげる♪【してやんよ】"===h&&(h="みくみくにしてあげる♪<br />【してやんよ】"),/([^~]+~+[^~])/g.test(h)&&u>=28&&(h=h.substring(0,h.search(/~/g))+"<br />"+h.substring(h.search(/~/g))),n+='<div class="song_name_container '+(i%2?"odd_colour":"even_colour")+'" id="'+t+'"><div class="song_rap"><div class="song_name">'+h+'</div><div class="song_credit'+(g?"":" hidden")+(song[t][song_idx.artist].length>30?" long_credit":"")+" song_"+t+'">'+song[t][song_idx.artist]+'</div></div><div class="song_icon_container"><div id="fold_'+t+'" class="song_fold_icon'+(g?"":" closed")+'"></div><div id="copy_name_'+t+'" class="song_copy_icon song_'+t+(g?"":" hidden")+'"></div></div></div>'}var f=entry[c][entry_idx.note].includes("【メン限"),m=""===entry[c][entry_idx.note]||"【メン限】"===entry[c][entry_idx.note]||"【メン限アーカイブ】"===entry[c][entry_idx.note],y=entry[c][entry_idx.note];if(f&&(y=y.includes("メン限アーカイブ")?y.replace(/【メン限アーカイブ】/g,""):y.replace(/【メン限】/g,"")),n+='<div class="entry_container singer_9'+(f?"m":"")+" song_"+t+(hide_song.includes(t)?" hidden":"")+'"><a href="https://youtu.be/'+video[entry[c][entry_idx.video]][video_idx.id]+timestamp(c)+'" target="_blank"><div class="entry_primary"><div class="entry_date">'+display_date(video[entry[c][entry_idx.video]][video_idx.date])+'</div><div class="entry_singer">つきみゆこ</div><div class="mem_display">'+(f?"メン限":"")+'</div><div class="entry_share" id="entry_'+c+'" onclick="return false;"></div></div>'+(m?"":'<div class="entry_note">'+y+"</div>")+"</a></div>",++a>=max_display){l=200;break}}}}do{if(""!==n)break;if(0===hits.length){n+='<div class="search_no_result">曲検索結果なし';break}if(o>0){n+='<div class="search_no_result">非表示動画のみ';break}n+='<div class="search_no_result">歌記録なし'}while(0);$("#search_display").html(n+"</div>");for(var l=0;l<hide_song.length;++l)r.includes(hide_song[l])||hide_song.splice(l--,1)}}function timestamp(s){return 0===entry[s][entry_idx.time]?"":"?t="+entry[s][entry_idx.time]}function max_count_update(s){var t=s.selectionStart,r=s.selectionEnd,i=$(s).val();i=i.replace(/[^\d]/g,"").substring(0,3),$("#search_options_count_input").val(i),s.setSelectionRange(t,r)}var attr_idx=["others","アニソン","ラブライブ","アイマス","マクロス","J-POP","ボカロ","ジブリ","特撮","ロック","歌謡曲","ポップス","R&B","キャラソン","disney"],rep_list=[],rep_anisong={lovelive:[1,2],imas:[1,3],macros:[1,4],other:[1,1]},rep_genre={jpop:[1,5],voc:[1,6],jib:[1,7],tok:[1,8],rock:[1,9],kay:[1,10],pops:[1,11],rnb:[1,12],cha:[1,13],dis:[1,14],other:[1,0]},rep_sort="50",rep_sort_asd=!0,rep_display_selected_first=!1,rep_info={attrdata:!0,date:!0},rep_edit_selected=-1,is_long_pressing=!1;$(function(){$(document).on("blur","#rep_input",function(){rep_search()}),$(document).on("keydown",function(s){13===s.keyCode&&"repertoire"===current_page&&$("#rep_input").blur()}),$(document).on("click",".filter_title",function(){var s=$(this).attr("id").replace(/(filter_)|(_title)/g,"");$("#filter_"+s+"_close").toggleClass("closed"),$("#filter_"+s+"_content").toggleClass("hidden")}),$(document).on("click",".filter_entry_attr_item",function(){var s=$(this).attr("id").replace(/(attr_container_)/,"");if("all"===s)for(var t in $(".attr_checkbox").toggleClass("selected",!$("#attr_"+s).hasClass("selected")),rep_attr)rep_attr[t]=$("#attr_"+s).hasClass("selected")?1:0;else if($("#attr_"+s).toggleClass("selected"),rep_attr[s]^=1,$("#attr_"+s).hasClass("selected")){for(var t in rep_attr)if(!rep_attr[t]){rep_search();return}$("#attr_all").addClass("selected")}else $("#attr_all").removeClass("selected");rep_search()}),$(document).on("click",".filter_genre_anisong_item",function(){var s=$(this).attr("id").replace(/(genre_container_anisong_)/,"");if("all"===s)for(var t in $(".genre_anisong_checkbox").toggleClass("selected",!$("#anisong_all").hasClass("selected")),rep_anisong)rep_anisong[t][0]=$("#anisong_all").hasClass("selected")?1:0;else if($("#anisong_"+s).toggleClass("selected"),rep_anisong[s][0]^=1,$("#anisong_"+s).hasClass("selected")){for(var t in rep_anisong)if(!rep_anisong[t][0]){rep_search();return}$("#anisong_all").addClass("selected")}else $("#anisong_all").removeClass("selected");rep_search()}),$(document).on("click",".filter_genre_general_item",function(){var s=$(this).attr("id").replace(/(genre_container_general_)/,"");if("all"===s)for(var t in $(".genre_general_checkbox").toggleClass("selected",!$("#general_all").hasClass("selected")),rep_genre)rep_genre[t][0]=$("#general_all").hasClass("selected")?1:0;else if($("#general_"+s).toggleClass("selected"),rep_genre[s][0]^=1,$("#general_"+s).hasClass("selected")){for(var t in rep_genre)if(!rep_genre[t][0]){rep_search();return}$("#general_all").addClass("selected")}else $("#general_all").removeClass("selected");rep_search()}),$(document).on("click",".filter_sort_item",function(){var s=$(this).attr("id").replace(/(sort_container_)/,"");rep_sort!==s&&($(".sort_checkbox").removeClass("selected"),$("#sort_"+s).addClass("selected"),rep_sort=s,update_rep_sort_display(),rep_display())}),$(document).on("click",".filter_sort2_item",function(){rep_sort_asd^=1,update_rep_sort_display(),rep_display()}),$(document).on("click",".filter_sort3_item",function(){rep_display_selected_first^=1,$(".sort3_checkbox").toggleClass("selected",rep_display_selected_first),rep_display()}),$(document).on("click",".filter_display_item",function(){var s=$(this).attr("id").replace(/(display_container_)/,"");$("#display_"+s).toggleClass("selected"),rep_info[s]^=1,rep_display()}),$(document).on("click",".rep_song_container",function(){if(!is_long_pressing){var s=parseInt($(this).attr("id").replace(/(rep_song_)/,""));$(this).hasClass("selected")?(rep_selected.splice(rep_selected.indexOf(s),1),0===rep_selected.length&&($("#nav_share").addClass("disabled"),$("#nav_bulk_search").addClass("disabled"))):(rep_selected.push(s),$("#nav_share").removeClass("disabled"),$("#nav_bulk_search").removeClass("disabled")),$(this).toggleClass("selected")}}),$(document).on("mousedown touchstart",".rep_song_container",function(){var s=parseInt($(this).attr("id").replace(/(rep_song_)/,""));longpress_timer=setTimeout(function(){navigator.clipboard.writeText(song[s][song_idx.name]),copy_popup(),is_long_pressing=!0,post_longpress_timer=setTimeout(function(){is_long_pressing=!1,clearTimeout(post_longpress_timer)},500)},600)}),$(document).on("mouseup mouseleft touchend touchmove",".rep_song_container",function(){clearTimeout(longpress_timer)}),$(document).on("click","#nav_bulk_search",function(){is_searching_from_rep=1,jump2page("search"),hits=copy_of(rep_selected),loading="!bulk_load_flag",$("#input").val(""),update_display(1)}),$(document).on("click","#nav_share",function(){!("repertoire"!==current_page||$(this).hasClass("disabled")||prevent_menu_popup)&&(prevent_menu_popup=!0,$(document.body).toggleClass("no_scroll"),$("#rep_list").removeClass("hidden"),$("#popup_container").removeClass("hidden"),rep_update_list())}),$(document).on("click","#rep_list_artist",function(){!$("#rep_list_artist").hasClass("disabled")&&($("#list_artist_cb").toggleClass("selected"),rep_update_list())}),$(document).on("click","#rep_list_edit",function(){0!==rep_selected.length&&(-1===rep_edit_selected?($("#rep_list_edit").html("編集終了"),$("#rep_list_artist").addClass("disabled"),$("#rep_list_close").addClass("disabled"),$("#rep_compose_tweet").addClass("disabled"),$("#rep_list_leftbar").removeClass("hidden"),$("#rep_list_container").addClass("editing"),rep_edit_selected=-2,rep_update_leftbar()):($("#rep_list_edit").html("編集"),$("#rep_list_artist").removeClass("disabled"),$("#rep_list_close").removeClass("disabled"),$("#rep_compose_tweet").removeClass("disabled"),$("#rep_list_leftbar").addClass("hidden"),$("#rep_list_container").removeClass("editing"),rep_edit_selected=-1))}),$(document).on("click",".rep_list_item",function(){var s=parseInt($(this).attr("id").replace(/(rep_btn_)/,""));switch(rep_edit_selected){case -1:case -2:rep_edit_selected=s,rep_update_leftbar();break;case s:rep_edit_selected=-2,rep_update_leftbar();break;default:if($(this).hasClass("arrow_up")){[rep_selected[s],rep_selected[s+1]]=[rep_selected[s+1],rep_selected[s]],rep_edit_selected--,rep_update_list(),rep_update_leftbar();var t=Math.max(0,rep_edit_selected-1),r=$("#rep_list_leftbar").offset().top,i=$("#rep_btn_"+t).offset().top;i<r&&($("#rep_list_leftbar").scrollTop($("#rep_list_leftbar").scrollTop()-r+i),$("#rep_list_content").scrollTop($("#rep_list_leftbar").scrollTop()))}if($(this).hasClass("arrow_down")){[rep_selected[s-1],rep_selected[s]]=[rep_selected[s],rep_selected[s-1]],rep_edit_selected++,rep_update_list(),rep_update_leftbar();var t=Math.min(rep_edit_selected+1,rep_selected.length-1),n=$("#rep_list_leftbar").offset().top+$("#rep_list_leftbar").height(),a=$("#rep_btn_"+t).offset().top+$("#rep_btn_"+t).height();a>n&&($("#rep_list_leftbar").scrollTop($("#rep_list_leftbar").scrollTop()-n+a),$("#rep_list_content").scrollTop($("#rep_list_leftbar").scrollTop()))}}}),$(document).on("click",".rep_list_delete",function(){rep_edit_selected>=0&&($("#rep_song_"+rep_selected[rep_edit_selected]).removeClass("selected"),rep_selected.splice(rep_edit_selected,1)),rep_edit_selected=-2,rep_update_list(),rep_update_leftbar(),0===rep_selected.length&&($("#rep_list_edit").html("編集"),$("#rep_list_artist").removeClass("disabled"),$("#rep_list_close").removeClass("disabled"),$("#rep_compose_tweet").removeClass("disabled"),$("#rep_list_leftbar").addClass("hidden"),$("#rep_list_container").removeClass("editing"),rep_edit_selected=-1,$("#nav_share").addClass("disabled"),$("#nav_bulk_search").addClass("disabled"))}),$("#rep_list_content").on("scroll",function(){$("#rep_list_leftbar").scrollTop($("#rep_list_content").scrollTop())}),$(document).on("click","#rep_list_close",function(){!$("#rep_list_close").hasClass("disabled")&&(prevent_menu_popup=!1,$("#rep_list").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).toggleClass("no_scroll"))}),$(document).on("click","#rep_compose_tweet",function(){if(!$("#rep_compose_tweet").hasClass("disabled")&&0!==rep_selected.length){prevent_menu_popup=!1,$("#rep_list").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).toggleClass("no_scroll");var s="";for(var t in rep_selected)s+=song[rep_selected[t]][song_idx.name]+($("#list_artist_cb").hasClass("selected")?" / "+song[rep_selected[t]][song_idx.artist]:"")+"\n";window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(s),"_blank")}}),$(document).on("click","#rep_copy",function(){var s="";for(var t in rep_selected)s+=song[rep_selected[t]][song_idx.name]+($("#list_artist_cb").hasClass("selected")?" / "+song[rep_selected[t]][song_idx.artist]:"")+"\n";navigator.clipboard.writeText(s),copy_popup()})});var rep_hits=[],rep_hits_solo=[],rep_hits_count=0,rep_selected=[],rep_input_memory="";function rep_search(s=!1){var t=$("#rep_input").val().normalize("NFKC").trim();if(t!==rep_input_memory)rep_input_memory=t;else if(!s&&""!==t)return;if(""!==rep_input_memory){rep_hits=[],rep_hits_count=0;for(var r=1;r<song.length;++r)0!==entry_proc[r].length&&(-1!==processed_song_name[r].search(t.toLowerCase())||-1!==song[r][song_idx.reading].search(t))&&(rep_hits[rep_hits_count++]=r);rep_display();return}var i=0;for(var r in rep_hits=[],rep_hits_count=0,rep_anisong)i+=rep_anisong[r][0]<<rep_anisong[r][1];for(var r in rep_genre)i+=rep_genre[r][0]<<rep_genre[r][1];var n=0;for(var r in rep_anisong)"other"!==r&&(n+=1-rep_anisong[r][0]<<rep_anisong[r][1]);for(var r=0;r<song.length;++r)if(song[r][song_idx.attr]&i){if(0!=n&&song[r][song_idx.attr]&n)continue;rep_hits[rep_hits_count++]=r}rep_display()}function rep_display(){if(rep_display_selected_first)for(var s in rep_selected)-1!==rep_hits.indexOf(rep_selected[s])&&rep_hits.splice(rep_hits.indexOf(rep_selected[s]),1);switch($("#rep_display").html(""),rep_sort){case"50":rep_hits.sort((s,t)=>s-t),rep_sort_asd||rep_hits.reverse();break;case"count":for(var t=[],s=1;s<song.length;++s)t[s]=entry_proc[s].length;rep_hits.sort((s,r)=>(rep_sort_asd?1:-1)*(t[r]-t[s]));break;case"date":for(var r=[],s=1;s<song.length;++s){var i=get_last_sang(s);r[s]=i?i.getTime():0}rep_hits.sort((s,t)=>(rep_sort_asd?1:-1)*(r[t]-r[s]));break;case"release":for(var r=[],s=1;s<song.length;++s)r[s]=to8601(song[s][song_idx.release]).getTime();rep_hits.sort((s,t)=>(rep_sort_asd?1:-1)*(r[t]-r[s]));break;default:console.log('rep_sort of type "'+rep_sort+'" not found');return}rep_display_selected_first&&(rep_hits=rep_selected.concat(rep_hits)),rep_loading_progress=0,rep_display_loop(),reb_display_inter=setInterval(rep_display_loop,10)}var rep_loading_progress=0;function rep_display_loop(){for(var s=Math.min(rep_loading_progress+20,rep_hits.length),t=rep_loading_progress;t<s;++t){var r=get_sang_count(rep_hits[t]),i='<div class="rep_song_container'+(rep_selected.includes(rep_hits[t])?" selected":"")+(r[0]>0&&r[0]===r[1]?" rep_mem_only":"")+'" id="rep_song_'+rep_hits[t]+'">';i+='<div class="rep_song_title">'+song[rep_hits[t]][song_idx.name]+" / "+song[rep_hits[t]][song_idx.artist]+"</div>",i+='<div class="rep_song_info grid_block-4">',i+="<div>"+r[0]+"回"+(r[1]>0?r[0]===r[1]?" (メン限のみ)":" ("+r[1]+"回メン限)":"")+"</div>";var n=get_last_sang(rep_hits[t]),a=get_date_different(n);if(i+="<div>"+(0===a?"今日":-1===a?"---":a+"日前")+"</div>",i+=rep_info.date?"<div>("+n.toISOString().slice(0,10)+")</div>":"<div></div>",rep_info.attrdata){var o={gui:0,oke:0};for(var l in entry_proc[rep_hits[t]])o[get_attr(entry_proc[rep_hits[t]][l])]++;i+='<div class="rep_extra_info grid_block-2"><div class="row-1 col-1">'+(o.gui>0?"弾語":"　　　")+'</div><div class="row-1 col-2">'+(o.oke>0?"音源":"　　")+"</div></div>"}$("#rep_display").append(i+"</div></div>")}(rep_loading_progress+=20)>=rep_hits.length&&clearInterval(reb_display_inter)}function rep_update_list(){for(var s="",t=0;t<rep_selected.length;++t)s+='<div id="rep_btn_'+t+'" class="rep_list_item"></div>';$("#rep_list_leftbar").html(s),s="";for(var r=$("#list_artist_cb").hasClass("selected"),i=0,t=0;t<rep_selected.length;++t){var n=song[rep_selected[t]][song_idx.name]+(r?" / "+song[rep_selected[t]][song_idx.artist]:"");for(var a in s+='<div id="list_'+t+'">'+n+"</div>",n)i+=/[ -~]/.test(n[a])?1:2;i++}$("#rep_list_content").html(s),$(".rep_list_wordcount").html("長さ<br />"+i+"/280"),$(".rep_list_wordcount").toggleClass("red_text",i>280)}function rep_update_leftbar(){$(".rep_list_item").attr("class","rep_list_item"),$(".rep_list_delete").addClass("hidden"),rep_edit_selected>=0&&($(".rep_list_item").addClass("blank"),rep_edit_selected>0&&$("#rep_btn_"+(rep_edit_selected-1)).attr("class","rep_list_item arrow_up"),$("#rep_btn_"+rep_edit_selected).attr("class","rep_list_item"),rep_edit_selected<rep_hits.length-1&&$("#rep_btn_"+(rep_edit_selected+1)).attr("class","rep_list_item arrow_down"),$(".rep_list_delete").removeClass("hidden"))}function update_rep_sort_display(){var s="";switch(rep_sort){case"50":s=rep_sort_asd?"正順 (⇌逆順)":"逆順 (⇌正順)";break;case"count":s=rep_sort_asd?"多い順 (⇌少ない順)":"少ない順 (⇌多い順)";break;case"date":case"release":s=rep_sort_asd?"新しい順 (⇌古い順)":"古い順 (⇌新しい順)";break;default:return 1}$("#sort_name_sort").html(s)}