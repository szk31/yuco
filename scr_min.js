const series_lookup={"マクロス":"マクロスまくろす","ラブライブ":"ラブライブらぶらいぶll","アイマス":"アイマスあいますデレマスでれます","ジブリ":"ジブリじぶり","物語シリーズ":"物語シリーズものがたりしりーず","まどマギ":"まどマギまどまぎ",disney:"disneyディズニーでぃずにー"},entry_idx={song_id:0,video:1,note:2,time:3,type:4},song_idx={name:0,artist:1,reading:2,attr:3,release:4,reference:5},video_idx={id:0,date:1},version="1.8.0";let prevent_menu_popup=!1,current_page="home",settings={set_hidden_unlocked:{value:!1,req_LS:!0},set_show_hidden:{value:!1,req_LS:!0},ser_show_private:{value:!0,req_LS:!0,prv_name:["pcsl_s_showHidden"]},ser_select_input:{value:!0,req_LS:!0,prv_name:["pcsl_s_selecInput"]},ser_via_song_name:{value:!0,req_LS:!1},ser_sort_by_date:{value:!0,req_LS:!1},ser_sort_asd:{value:!0,req_LS:!1},ser_rand_show:{value:!1,req_LS:!0,prv_name:["pcsl_s_showRandom"]},ser_rand_req_empty:{value:!1,req_LS:!0,prv_name:["pcsl_s_ignoreRule"]},pdt_on_change_only:{value:!0,req_LS:!0,prv_name:["pcsl_s_autoAnyway"]},pdt_reading:{value:!0,req_LS:!0,prv_name:["pcsl_s_shwReading"]},pdt_copy_on_select:{value:!1,req_LS:!0},rep_show_release:{value:!1,req_LS:!0,prv_name:["pcsl_s_showReleas"]},rep_long_press_copy:{value:!0,req_LS:!0,prv_name:["pcsl_s_LPressCopy"]},rep_long_press_time:{value:600,req_LS:!0,prv_name:["pcsl_s_longP_time"]},rep_select_input:{value:!0,req_LS:!0,prv_name:["pcsl_s_rep_select"]},rep_sort_method:{value:"50",req_LS:!1},rep_sort_asd:{value:!0,req_LS:!1},rep_selected_first:{value:!1,req_LS:!1},rep_show_artist:{value:!0,req_LS:!0,prv_name:["pcsl_s_rep_artist"]}};function update_setting(e){return ls(`pcsl_${e}`,settings[e].value),settings[e].value}function toggle_setting(e){return settings[e].value^=1,update_setting(e)}let entry_proc=[],memcount_rep_int,processed_song_name=[""],auto_skips=[];{let e=ls("theme");e||(e="mixed",ls("theme",e)),document.documentElement.setAttribute("theme",e)}document.addEventListener("DOMContentLoaded",async function(){if(window.innerHeight/window.innerWidth<1.5){$("#v_screen").addClass("post_switch"),$("#v_screen").height("100%"),$("#v_screen").width(.5625*window.innerHeight),$("#v_screen").attr("src","index.html"+window.location.search),$("body > div").addClass("post_switch"),$("body").addClass("post_switch"),song=song_lookup=note_index=null;return}init()});function init(){$("#loading_text").html("Processing data..."),load_setting_flags(),process_data(),load_url_para(),$("#loading_text").html("Loading Complete.<br />You can't see this tho"),$("#loading_overlay").addClass("hidden"),$("body").removeClass("allow_reload")}function load_setting_flags(){$(`#three_way_${ls("theme")==="extra"?"dark":ls("theme")}`).addClass("selected");function e(e,t){ls(e,typeof t=="number"?t:t?1:0)}const t=new URLSearchParams(window.location.search).has("reset_settings");switch(t&&ls("theme","mixed"),Object.entries(settings).forEach(([n,s])=>{if(!s.req_LS)return;const i=`pcsl_${n}`;if(t){localStorage.removeItem(i),ls(i,typeof s.value=="number"?s.value:s.value?1:0);return}let o=ls(i);if(!o){if(!settings[n].prv_name?.length){e(i,s.value);return}const t=settings[n].prv_name.find(e=>ls(e));if(t)o=ls(t),localStorage.removeItem(t),ls(i,o);else{e(i,s.value);return}}const c=settings[n].value;switch(o){case"0":case"1":settings[n].value=o==1;break;default:settings[n].value=parseInt(o)}o=settings[n].value;const a=settings[n].value!==c;let r=`#setting_${n}>div`;switch(n){case"set_hidden_unlocked":settings[n].value&&$("#setting_extra_container").removeClass("hidden");return;case"set_show_hidden":a&&$(".settings_extra").removeClass("hidden");break;case"ser_rand_show":$("#nav_search_random").toggleClass("blank",!o),$(".setting_req_random").toggleClass("disabled",!o);break;case"rep_long_press_time":a&&($("#three_way_time>div").removeClass("selected"),$(`#three_way_${o}`).addClass("selected"));return;case"rep_show_artist":r=".rep_tweet_a";break;case"rep_long_press_copy":$("#three_way_time").toggleClass("disabled",!o);break}a&&$(r).toggleClass("selected")}),ls("theme")){case"light":case"mixed":$("#setting_dark_container>div").addClass("disabled");break;case"extra":$("#setting_dark").click()}}function process_data(){$("#input").val("");{const t=new Date("2021-01-01");function e(e){let n=new Date(t);return n.setDate(t.getDate()+e),n.toISOString().slice(0,10)}for(let t in video)video[t][video_idx.date]=e(video[t][video_idx.date]);for(let e in entry)entry[e][entry_idx.note]=note_index[entry[e][entry_idx.note]];note_index=null}for(let e in song)entry_proc[e]=[];for(let e=0;e<entry.length;++e)entry_proc[entry[e][0]].push(e);$("#info_version").html(version),$("#info_last-update").html(video[video.length-1][video_idx.date]),auto_display_max=Math.floor(7*window.innerHeight/window.innerWidth);for(let e=1;e<song.length;++e)processed_song_name.push(song[e][song_idx.name].toLowerCase().normalize("NFKC")),e>2&&song[e][song_idx.name].trim()===song[e-1][song_idx.name].trim()&&auto_skips.push(e)}function load_url_para(){let e=new URLSearchParams(window.location.search);e.delete("reset_settings"),window.history.pushState(null,null,`${document.location.href.split("?")[0]}${e.size?`?${e}`:""}`);let t=e.get("page");if(t!=="home"&&jump2page(t)===-1&&jump2page("home"),e.get("search")!==null){current_page!=="search"&&jump2page("search");let t=e.get("search").split(",");if(t.length>1){let e=0;for(let s in t){let n=parseInt(t[s]);n>=1&&n<song.length&&(hits[e++]=song_lookup[n])}is_searching_from_rep=1,loading="!bulk_load_flag",update_display(1)}else t>=1&&t<song.length&&($("#input").val(song[song_lookup[t]][song_idx.name]),$("#input").blur())}if(e.get("rfilter")!==null){current_page!=="repertoire"&&jump2page("rep");let t=[],n=parseInt(e.get("rfilter")),s=0;for(;n;)n%2&&t.push(s),n>>=1,s++;for(let e in rep_anisong)t.includes(rep_anisong[e][1])||$("#anisong_"+e).click();for(let e in rep_genre)t.includes(rep_genre[e][1])||$("#general_"+e).click()}$("#loading_text").html("Loading Complete.<br />You can't see this tho"),$("#loading_overlay").addClass("hidden"),$("body").removeClass("allow_reload")}$(function(){$(document).on("click","#nav_menu",function(e){if(e.preventDefault(),prevent_menu_popup)return;$("#menu_container").toggleClass("hidden"),$("#nav_menu").toggleClass("menu_opened"),$(document.body).toggleClass("no_scroll")}),$(document).on("click","#nav_to_top",function(e){if(e.preventDefault(),prevent_menu_popup)return;let t=$("html,body").scrollTop(),n=t/33;function s(){t-=n,$("html,body").scrollTop(t),t<=0&&clearInterval(o)}let o=setInterval(s,1);current_page==="repertoire"&&setting.rep_selected_first&&rep_display()}),$(document).on("click","#menu_container",function(e){$(e.target).parents(".defog").length||$(e.target).hasClass("defog")||($("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll"))}),$(document).on("click",".menu2page",function(e){let t=$(e.target).attr("id").replace("menu2page_","");if(t===current_page)return;jump2page(t),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),$(document.body).removeClass("no_scroll")}),$(document).on("click","#menu_setting",function(){$("#popup_container").removeClass("hidden"),$("#settings").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0}),$(document).on("click","#menu_info",function(){$("#popup_container").removeClass("hidden"),$("#information").removeClass("hidden"),$("#menu_container").addClass("hidden"),$("#nav_menu").removeClass("menu_opened"),prevent_menu_popup=!0});{let e=0;$(document).on("click",function(t){$(t.target).closest(".settings_title").length?++e===5&&(ls("pcsl_set_hidden_unlocked",1),$("#setting_extra_container").removeClass("hidden")):e=0}),$(document).on("click","#three_way_theme>div",function(){let e=this.id.replace("three_way_","");$("#setting_dark").toggleClass("disabled",e!=="dark"),e!=="dark"&&($("#setting_dark>div").removeClass("selected"),$("#dark_normal").addClass("selected")),document.documentElement.setAttribute("theme",e),ls("theme",e),$("#three_way_theme>div").removeClass("selected"),$(this).addClass("selected")}),$(document).on("click","#three_way_time>div",function(){if($(".setting_copy_time").hasClass("disabled"))return;let e=parseInt(this.id.replace("three_way_",""));ls("pcsl_rep_long_press_time",e),settings.rep_long_press_time.value=e,$("#three_way_time>div").removeClass("selected"),$(this).addClass("selected")}),$(document).on("click",".two_way:not(.disabled)",function(){$(this).children().toggleClass("selected");const e=this.id.replace("setting_","");switch(e){case"set_show_hidden":$(".settings_extra").toggleClass("hidden",toggle_setting(e));break;case"dark":let t=$("#dark_extra").hasClass("selected")?"extra":"dark";ls("theme",t),document.documentElement.setAttribute("theme",t);break;case"ser_show_private":toggle_setting(e),update_display(1);break;case"ser_rand_show":const n=toggle_setting(e);$("#nav_search_random").toggleClass("blank",n),$(".setting_req_random").toggleClass("disabled",!n);break;case"ser_rand_req_empty":toggle_setting(e),$("#nav_search_random").toggleClass("disabled",!settings.ser_via_song_name.value||!settings.ser_rand_req_empty.value&&search_memory!=="");break;case"rep_show_release":toggle_setting(e),current_page==="repertoire"&&rep_display();break;case"rep_long_press_copy":$(".setting_copy_time").toggleClass("disabled",!toggle_setting(e));break;case"ser_select_input":case"pdt_on_change_only":case"pdt_reading":case"pdt_copy_on_select":case"rep_select":toggle_setting(e);break}}),$(document).on("click","#settings_reset_button, #settings_reset_nah",function(){$(".settings_reset>span").toggleClass("hidden"),$("#settings_reset_confirm").toggleClass("blank")}),$(document).on("click","#settings_reset_yes",function(){const e=new URL(window.location.href);e.searchParams.set("reset_settings",""),window.location.href=e.toString()})}$(document).on("click","#popup_container",function(e){$(e.target).closest(".popup_frame").length||($(".popup_frame").addClass("hidden"),$("#popup_container").addClass("hidden"),$(document.body).removeClass("no_scroll"),prevent_menu_popup=!1)}),$(document).on("click",".home_hyperlink_block",function(){jump2page($(this).attr("id").replace("home_hyper_",""))})});function display_date(e){let t=typeof e=="string"?new Date(e):e;return t.getFullYear()+"-"+fill_digit(t.getMonth()+1,2)+"-"+fill_digit(t.getDate(),2)}function fill_digit(t,n){for(e=""+t;e.length<n;)e="0"+e;return e}function is_private(e){return entry[e][entry_idx.note].includes("非公開")||entry[e][entry_idx.note].includes("記録用")||entry[e][entry_idx.note].includes("アーカイブなし")}function bold(e,t){let n=e.toLowerCase().indexOf(t.toLowerCase());return n===-1||t===""?e:e.substring(0,n)+"<b>"+e.substring(n,n+t.length)+"</b>"+e.substring(n+t.length)}function copy_of(e){return typeof e=="object"?JSON.parse(JSON.stringify(e)):e}function get_last_sang(e){return new Date(video[entry[entry_proc[e][entry_proc[e].length-1]][entry_idx.video]][video_idx.date])}function to8601(e){try{return new Date(e.substring(6),parseInt(e.substring(3,5))-1,e.substring(0,2))}catch{return console.log(e+" is not in dd-MM-yyyy format"),-1}}const today=(new Date).setHours(0,0,0,0);function get_date_different(e,t=today){return e=typeof e=="string"?new Date(e):e,t=t===void 0?t:new Date(t),Math.round(Math.abs(e-t)/864e5)}function get_sang_count(e){let t=mem_count=0;for(var n in entry_proc[e])t++,entry[entry_proc[e][n]][entry_idx.note].includes("【メン限")&&mem_count++;return[t,mem_count]}function get_attr(e){var t=entry[e][entry_idx.note];return t.includes("弾き語り")?"gui":t.includes("アカペラ")?"aca":"oke"}function jump2page(e){switch(e=e==="rep"?"repertoire":e,current_page=e,$(".menu2page_selected").removeClass("menu2page_selected"),$("#menu2page_"+e).addClass("menu2page_selected"),$(".section_container").addClass("hidden"),$("#"+e+"_section").removeClass("hidden"),$("#nav_dummy").addClass("hidden"),$("#nav_search_random").addClass("hidden"),$("#nav_bulk_search").addClass("hidden"),$("#nav_share").addClass("hidden"),$("#search_display").html(""),$("#rep_display").html(""),e){case"home":$("#nav_title").html("ホーム"),$("#nav_dummy").removeClass("hidden");break;case"search":$("#nav_search_random").removeClass("hidden"),$("#nav_title").html("曲検索"),$("#input").val(""),search();break;case"rep":case"repertoire":$("#repertoire_section").removeClass("hidden"),$("#nav_share").removeClass("hidden"),$("#nav_share").toggleClass("disabled",!rep_selected.length),$("#nav_title").html("レパートリー"),rep_input_memory="",rep_search();break;default:return-1}$(window).scrollTop(0)}let copy_popup_flag=!1;function copy_popup(){if(copy_popup_flag)return;copy_popup_flag=!0,$("#copy_popup").attr("class","fade_out"),setTimeout(()=>{copy_popup_flag=!1,$("#copy_popup").attr("class","hidden")},1500)}function to_html(e){return e.replaceAll(`"`,`&quot;`).replaceAll(`'`,`&apos;`)}function to_non_html(e){return e.replaceAll(`&quot;`,`"`).replaceAll(`&apos;`,`'`)}function refresh_bgColour(){document.documentElement.setAttribute("theme",ls("theme"))}function ls(e,t){return t===void 0?localStorage.getItem(e):localStorage.setItem(e,t)}let search_memory="",hide_song=new Array,auto_display_max,is_searching_from_rep=!1,input_focused=!1;$(function(){let e;$(document).on("click","#nav_search_random",function(){if($(this).hasClass("disabled")&&!settings.ser_rand_req_empty.value||prevent_menu_popup)return;let t,n=0;for(;!n;){if(t=1+Math.floor(Math.random()*song.length),t===e)continue;for(let e in entry_proc[t]){if(!settings.ser_show_private.value&&is_private(entry_proc[t][e]))continue;n++;break}}e=t,$("#search_input").val(song[t][song_idx.name]),is_searching_from_rep=0,search()});{$(document).on("input","#search_input",function(){auto_search()}),$(document).on("mousedown",".auto_panel",function(){$("#search_input").val(to_non_html(this.id))});let e=0;$(document).on("keydown",function(t){let n=Object({38:-1,40:1})[t.keyCode];if($("#search_auto").hasClass("hidden")||n===void 0||auto_input_memory!==get_search_input()||!e&&n===-1)return;e=Math.max(1,Math.min(auto_display_max,auto_display_count,e+n)),$("#search_auto>div").removeClass("selected"),$(`#search_auto>div:nth-child(${e})`).addClass("selected")}),$(document).on("blur","#search_input",function(){$("#search_auto").addClass("hidden"),input_focused=!1,is_searching_from_rep?is_searching_from_rep=0:$("#nav_share").toggleClass("disabled",!is_searching_from_rep),search()}),$(document).on("keydown",function(t){if(t.keyCode===13&&current_page==="search"){if(e){e=0;const t=$(".auto_panel.selected")[0].id;$("#search_input").val(t),settings.pdt_copy_on_select.value&&(navigator.clipboard.writeText(t),copy_popup())}$("#search_input").blur()}}),$(document).on("click","#search_input, #rep_input",function(){if(input_focused)return;if(input_focused=!0,settings.ser_select_input.value&&this.id==="search_input"||settings.rep_select_input.value&&this.id==="rep_input"){let e=this;setTimeout(function(){e.setSelectionRange(0,$(e).val().length)},0)}else search_memory==="!bulk_load_flag"&&this.id==="search_input"&&($(this).val(""),$("#nav_search_random").removeClass("disabled"),$("#nav_share").addClass("disabled"));this.id==="search_input"&&auto_search()}),$(document).on("click","#ser_opt_button",function(){$(this).toggleClass("opened"),$("#ser_opt_container").toggleClass("hidden")}),$(document).on("click",".ser_opt_gp1",function(){let e=this.id==="ser_opt_songname";if(e===settings.ser_via_song_name.value)return;settings.ser_via_song_name.value=e,$(".ser_opt_gp1>.radio").toggleClass("selected"),$("#search_input").val(""),$("#search_input").attr("placeholder",settings.ser_via_song_name.value?"曲名/読みで検索":"アーティスト名で検索"),$("#search_display").html(""),search_memory="",$("#nav_search_random").toggleClass("disabled",!settings.ser_via_song_name.value)});function t(){$("#ser_opt_asd>div:nth-child(2)").html(new Array("古い順&nbsp;(⇌新しい順)","新しい順&nbsp;(⇌古い順)","正順&nbsp;(⇌逆順)","逆順&nbsp;(⇌正順)")[(settings.ser_sort_by_date.value?0:2)+(settings.ser_sort_asd.value?0:1)])}$(document).on("click",".ser_opt_gp2",function(){let e=this.id==="ser_opt_date";if(e===settings.ser_sort_by_date.value)return;settings.ser_sort_by_date.value=e,$(".ser_opt_gp2>.radio").toggleClass("selected"),t(),update_display()}),$(document).on("click","#ser_opt_asd",function(){settings.ser_sort_asd.value^=1,t(),update_display()}),$(document).on("click",".song_name_container",function(e){if($(e.target).hasClass("song_copy_icon"))return;let t=this.id;hide_song.includes(t)?hide_song.splice(hide_song.indexOf(t),1):hide_song.push(t),$(".song_"+t).toggleClass("hidden"),$("#fold_"+t).toggleClass("closed")}),$(document).on("click",".song_copy_icon",function(){navigator.clipboard.writeText(song[parseInt(this.id.replace("copy_name_",""))][song_idx.name]),copy_popup()}),$(document).on("click",".entry_share",function(e){e.preventDefault();let t=parseInt(this.id.replace("entry_",""));const n="https://www.youtube.com/watch?v="+video[entry[t][entry_idx.video]][video_idx.id];fetch("https://noembed.com/embed?dataType=json&url="+n).then(e=>e.json()).then(function(e){if(!e.title){alert("動画タイトル取得できませんでした。");return}let n;entry[t][entry_idx.time]===0?n=e.title+`
(youtu.be/`+video[entry[t][entry_idx.video]][video_idx.id]+")":n=song[entry[t][entry_idx.song_id]][song_idx.name].trim()+" / "+song[entry[t][entry_idx.song_id]][song_idx.artist]+" @"+e.title+`
(youtu.be/`+video[entry[t][entry_idx.video]][video_idx.id]+timestamp(t)+")",window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(n),"_blank")})})}});let hits=[],auto_input_memory="";function auto_search(){let e=get_search_input();if(auto_input_memory===e&&!settings.pdt_on_change_only.value)return;if(auto_input_memory=e,!e||!settings.ser_via_song_name.value){$("#search_auto").addClass("hidden");return}let t=[],n=[];function o(e,s){s?s>0&&n.push(e):t.push(e)}for(let n in series_lookup)series_lookup[n].includes(e)&&t.push(n);const a=/[^\u3040-\u309F\u30FC\u30F4]/.test(e),i=r2k(e);for(let n=1;n<song.length&&t.length<auto_display_max;++n){if(auto_skips.includes(n))continue;if(!a){o(n,song[n][song_idx.reading].indexOf(e));continue}let s=processed_song_name[n].indexOf(e);s===-1&&song[n][song_idx.reading].includes(" ")&&song[n][song_idx.reading].includes(e)&&(s=1),s===-1&&i&&(s=song[n][song_idx.reading].indexOf(i)),o(n,s)}auto_display_count=0;let s="";for(let n in t){let o=auto_display=song_name="";typeof t[n]=="string"?auto_display=song_name=t[n]:(o=bold(song[t[n]][song_idx.reading].split(" ")[0],e),song_name=song[t[n]][song_idx.name],auto_display=bold(song_name,e)),s+=`<div id="${to_html(song_name)}" class="auto_panel${auto_display_count++===0?" auto_first":""}"><div class="auto_reading${!o||!settings.pdt_reading.value?" auto_no_reading":""}">${o}</div><div class="auto_display">${auto_display}</div></div>`}for(let t in n){if(auto_display_count++>=auto_display_max)break;s+=`<div id="${to_html(song[n[t]][song_idx.name])}" class="auto_panel${auto_display_count===0?" auto_first":""}"><div class="auto_reading${settings.pdt_reading.value?"":" auto_no_reading"}">${song[n[t]][song_idx.reading].split(" ")[0]}</div><div class="auto_display">${bold(song[n[t]][song_idx.name],e)}</div></div>`}$("#search_auto").html(s),$("#search_auto").toggleClass("hidden",!s),auto_pointer=0,$("#search_auto>div").removeClass("selected")}function search(){if(is_searching_from_rep){update_display();return}let e=get_search_input();if(e===search_memory)return;if(search_memory=e,e===""){$("#search_display").html(""),$("#nav_search_random").removeClass("disabled");return}$("#nav_search_random").toggleClass("disabled",!settings.ser_rand_req_empty.value);const s=e in series_lookup?e:"",n=attr_idx.includes(e)?attr_idx.indexOf(e):0;hits=[];let o=0;if(s)song.forEach((t,s)=>s?(n?t[song_idx.attr]&1<<n:t[song_idx.reading].includes(e))?hits.push(s):null:null);else{const n=200,s=r2k(e);for(var t=1;t<song.length&&hits.length<n;++t)(settings.ser_via_song_name.value?processed_song_name[t].includes(e)||song[t][song_idx.reading].toLowerCase().includes(e)||song[t][song_idx.reading].includes(s):song[t][song_idx.artist].toLowerCase().includes(e))&&(processed_song_name[t]===e?hits.splice(o++,0,t):hits.push(t))}update_display()}function update_display(e=!1){if(e|=is_searching_from_rep,$("#search_auto").addClass("hidden"),search_memory===""&&!e)return;let t=-1,s=[],o=found_entries=0,n="";for(let e=0;e<hits.length&&e<=200;++e){let i=[];settings.ser_sort_by_date.value?i=entry_proc[hits[e]].sort((e,t)=>settings.ser_sort_asd.value?e-t:t-e):i=entry_proc[hits[e]].sort((e,t)=>entry[e][entry_idx.type]===entry[t][entry_idx.type]?e-t:(settings.ser_sort_asd.value?1:-1)*(display_order[entry[e][entry_idx.type]]-display_order[entry[t][entry_idx.type]])),found_entries+=i.length;for(let r=0;r<i.length;++r){let a=i[r];if(!settings.ser_show_private.value&&is_private(a))continue;if(t!==entry[a][entry_idx.song_id]){n+=(t!==-1?"</div>":"")+`<div class="song_container">`,t=entry[a][entry_idx.song_id],s.push(t);let o=!hide_song.includes(t),e=song[t][song_idx.name].normalize("NFKC"),i=0;for(let t=0;t<e.length;++t)i+=/[ -~]/.test(e.charAt(t))?1:2;["secret base ~君がくれたもの~","かくしん的☆めたまるふぉ～ぜっ！","ススメ☆オトメ ~jewel parade~","Time after time ～花舞う街で～"].includes(e)&&(i=0),e==="みくみくにしてあげる♪【してやんよ】"&&(e="みくみくにしてあげる♪<br />【してやんよ】"),/([^~]+~+[^~])/g.test(e)&&i>=28&&(e=e.substring(0,e.search(/~/g))+"<br />"+e.substring(e.search(/~/g))),n+=`<div class="song_name_container" id="${t}"><div class="song_rap"><div class="song_name">${e}</div><div class="song_credit${o?"":" hidden"}${song[t][song_idx.artist].length>30?" long_credit":""} song_${t}">${song[t][song_idx.artist]}</div></div><div class="song_icon_container"><div id="fold_${t}" class="song_fold_icon${o?"":" closed"}"></div><div id="copy_name_${t}" class="song_copy_icon song_${t}${o?"":" hidden"}"></div></div></div>`}let c=entry[a][entry_idx.note].includes("【メン限"),d=entry[a][entry_idx.note]===""||entry[a][entry_idx.note]==="【メン限】"||entry[a][entry_idx.note]==="【メン限アーカイブ】",l=entry[a][entry_idx.note];if(c&&(l=l.replace(/【メン限アーカイブ】|【メン限】/g,"")),n+=`<div class="entry_container singer_8${c?"m":""} song_${t}${hide_song.includes(t)?" hidden":""}"><a href="https://youtu.be/${video[entry[a][entry_idx.video]][video_idx.id]}${timestamp(a)}" target="_blank"><div class="entry_primary"><div class="entry_date">${display_date(video[entry[a][entry_idx.video]][video_idx.date])}</div><div class="entry_singer">つきみゆこ</div><div class="mem_display">${c?"メン限":""}</div><div class="entry_share" id="entry_${a}"></div></div>${d?"":`<div class="entry_note">${l}</div>`}</a></div>`,++o>=400){e=200;break}}}hits.length?found_entries?n===""&&(n+=`<div class="search_no_result">非表示動画のみ`):n+=`<div class="search_no_result">歌記録なし`:n+=`<div class="search_no_result">曲検索結果なし`,$("#search_display").html(n+`</div><div class="general_vertical_space"></div>`);for(let e=0;e<hide_song.length;++e)s.includes(hide_song[e])||hide_song.splice(e--,1)}function timestamp(e){let t=entry[e][entry_idx.time];return t?"?t="+t:""}function get_search_input(){return $("#search_input").val().normalize("NFKC").toLowerCase().trim()}const attr_idx=["others","アニソン","ラブライブ","アイマス","マクロス","J-POP","ボカロ","ジブリ","特撮","ロック","歌謡曲","disney"];let rep_anisong={lovelive:[1,2],imas:[1,3],macros:[1,4],other:[1,1]},rep_genre={jpop:[1,5],voc:[1,6],jib:[1,7],tok:[1,8],rock:[1,9],kay:[1,10],dis:[1,11],other:[1,0]};var rep_info={attrdata:!0,date:!0};const oke_gone=["ノーザンクロス"];let longpress_timer,post_longpress_timer,is_long_pressing=!1;$(function(){$(document).on("blur","#rep_input",function(){input_focused=!1,rep_search()}),$(document).on("keydown",function(e){e.keyCode===13&&current_page==="repertoire"&&$("#rep_input").blur()}),$(document).on("click","#filter_display",function(){$("#filter_close").toggleClass("closed"),$("#filter_content").toggleClass("hidden")}),$(document).on("click",".filter_anisong",function(){let e=this.id.replace("anisong_","");if(e==="all"){$(".filter_anisong .checkbox").toggleClass("selected",!$("#anisong_all .checkbox").hasClass("selected"));for(let e in rep_anisong)rep_anisong[e][0]=$("#anisong_all .checkbox").hasClass("selected")?1:0}else if($(`#${this.id} .checkbox`).toggleClass("selected"),rep_anisong[e][0]^=1,$(`#${this.id} .checkbox`).hasClass("selected")){for(let e in rep_anisong)if(!rep_anisong[e][0]){rep_search();return}$("#anisong_all .checkbox").addClass("selected")}else $("#anisong_all .checkbox").removeClass("selected");rep_search()}),$(document).on("click",".filter_genre",function(){let t=this.id.replace("genre_","");const e="#genre_all .checkbox";if(t==="all"){$(".filter_genre .checkbox").toggleClass("selected",!$(e).hasClass("selected"));for(let t in rep_genre)rep_genre[t][0]=$(e).hasClass("selected")?1:0}else if($(`#${this.id} .checkbox`).toggleClass("selected"),rep_genre[t][0]^=1,$(`#${this.id} .checkbox`).hasClass("selected")){for(let e in rep_genre)if(!rep_genre[e][0]){rep_search();return}$(e).addClass("selected")}else $(e).removeClass("selected");rep_search()}),$(document).on("click",".filter_sort",function(){let e=this.id.replace("sort_","");if(settings.rep_sort_method.value===e)return;$(".filter_sort .radio").removeClass("selected"),$(`#${this.id} .radio`).addClass("selected"),settings.rep_sort_method.value=e,update_rep_sort_display(),rep_display()}),$(document).on("click","#filter_asd",function(){settings.rep_sort_asd.value^=1,update_rep_sort_display(),rep_display()}),$(document).on("click",".filter_display",function(){rep_info[this.id.replace("display_","")]^=1,$(`#${this.id} .checkbox`).toggleClass("selected"),rep_display()}),$(document).on("click","#sort_selected",function(){settings.rep_selected_first.value^=1,$("#sort_selected .checkbox").toggleClass("selected"),rep_display()}),$(document).on("click",".rep_song_container",function(){if(is_long_pressing)return;let e=parseInt(this.id.replace("rep_song_",""));$(this).hasClass("selected")?(rep_selected.splice(rep_selected.indexOf(e),1),rep_selected.length||$("#nav_share").addClass("disabled")):(rep_selected.push(e),$("#nav_share").removeClass("disabled")),$(this).toggleClass("selected")}),$(document).on("mousedown touchstart",".rep_song_container",function(){if(!settings.rep_long_press_copy.value)return;let e=parseInt(this.id.replace(/(rep_song_)/,""));longpress_timer=setTimeout(function(){navigator.clipboard.writeText(song[e][song_idx.name]),copy_popup(),is_long_pressing=!0,post_longpress_timer=setTimeout(function(){is_long_pressing=!1,clearTimeout(post_longpress_timer)},settings.rep_long_press_time.value-100)},settings.rep_long_press_time.value)}),$(document).on("mouseup mouseleft touchend touchmove",".rep_song_container",function(){clearTimeout(longpress_timer)}),$(document).on("click","#nav_share",function(){if(current_page!=="repertoire"||$(this).hasClass("disabled")||prevent_menu_popup)return;prevent_menu_popup=!0,$(document.body).toggleClass("no_scroll"),$("#rep_share").removeClass("hidden"),$("#popup_container").removeClass("hidden")}),$(document).on("click","#rep_share_search",function(){$("#popup_container").click(),is_searching_from_rep=1,jump2page("search"),hits=copy_of(rep_selected),loading="!bulk_load_flag",$("#input").val(""),update_display(1)}),$(document).on("click","#rep_share_link",function(){$("#popup_container").click();let e="szk31.github.io/yuco/?search="+song_lookup.indexOf(rep_selected[0]);for(let t=1;t<rep_selected.length;++t)e+=","+song_lookup.indexOf(rep_selected[t]);navigator.clipboard.writeText(e),copy_popup()}),$(document).on("click","#rep_share_tweet",function(){$("#rep_share").addClass("hidden"),$("#rep_tweet").removeClass("hidden")}),$(document).on("click",".rep_tweet_a",function(){if(settings.rep_show_artist.value==(this.id==="rep_tweet_ya"))return;settings.rep_show_artist.value^=1,$(".rep_tweet_a").toggleClass("selected"),update_setting("rep_show_artist")}),$(document).on("click",".rep_tweet_submit",function(){let e="";for(let t in rep_selected)e+=`${song[rep_selected[t]][song_idx.name]}${settings.rep_show_artist.value?" / "+song[rep_selected[t]][song_idx.artist]:""}
`;let t=this.id.replace("rep_tweet_","");switch(t){case"t":navigator.clipboard.writeText(e),copy_popup();break;default:window.open("https://twitter.com/intent/tweet?text="+encodeURIComponent(e+"#つきみゆこ"),"_blank")}$("#popup_container").click()})});let rep_hits=[],rep_hits_solo=[],rep_hits_count=0,rep_selected=[],rep_input_memory="";function rep_search(e=!1){let t=$("#rep_input").val().normalize("NFKC").trim();if(t!==rep_input_memory)rep_input_memory=t;else if(!e&&t)return;if(rep_hits=[],t){for(let e=1;e<song.length;++e){if(!entry_proc[e].length)continue;(processed_song_name[e].includes(t)||song[e][song_idx.reading].includes(t))&&rep_hits.push(e)}rep_display();return}let n=inv_mask=0;Object.values(rep_anisong).concat(Object.values(rep_genre)).forEach(e=>n+=e[0]<<e[1]),Object.values(rep_anisong).forEach(e=>inv_mask+=e[0]<<e[1]),inv_mask=~inv_mask&28;for(i in song)song[i][song_idx.attr]&n&&!(song[i][song_idx.attr]&inv_mask)&&rep_hits.push(i);rep_display()}let rep_display_inter;function rep_display(){if($("#rep_count").html(`hit${rep_hits.length>1?"s":""}: ${rep_hits.length}`),settings.rep_selected_first.value&&(rep_hits=rep_hits.filter(e=>!rep_selected.includes(e))),!rep_hits.length){$("#rep_display").html(`<div class="search_no_result">検索結果なし</div>`);return}switch($("#rep_display").html(""),settings.rep_sort_method.value){case"50":rep_hits.sort((e,t)=>(settings.rep_sort_asd.value?1:-1)*(e-t));break;case"count":let e=[];rep_hits.forEach(t=>e[t]=entry_proc[t].length),rep_hits.sort((t,n)=>(settings.rep_sort_asd.value?1:-1)*(e[n]-e[t]));break;case"date":{let e=[];for(let t=1;t<song.length;++t){let n=get_last_sang(t);e[t]=n?n.getTime():0}rep_hits.sort((t,n)=>(settings.rep_sort_asd.value?1:-1)*(e[n]-e[t]));break}case"release":{let e=[];rep_hits.forEach(e=>rls_lookup[e]=to8601(song[e][song_idx.release]).getTime()),rep_hits.sort((e,t)=>(settings.rep_sort_asd.value?1:-1)*(rls_lookup[t]-rls_lookup[e]));break}}settings.rep_selected_first.value&&(rep_hits=rep_selected.concat(rep_hits)),rep_loading_progress=0,rep_display_loop(),clearInterval(rep_display_inter),rep_display_inter=setInterval(rep_display_loop,10)}let rep_loading_progress=0;function rep_display_loop(){let t=Math.min(rep_loading_progress+20,rep_hits.length);for(let s=rep_loading_progress;s<t;++s){let o=get_sang_count(rep_hits[s]),i=get_last_sang(rep_hits[s]),a=i===0?-1:get_date_different(i),r="";if(rep_info.attrdata){var n,e={gui:0,oke:0};for(n in entry_proc[rep_hits[s]])e[get_attr(entry_proc[rep_hits[s]][n])]++;r=`<div class="rep_extra_info grid_block-2"><div class="row-1 col-1">${e.gui>0?"弾語":"　　　"}</div><div class="row-1 col-2">${e.oke>0?"音源":"　　"}</div></div>`}let c=`<div class="rep_song_container${rep_selected.includes(rep_hits[s])?" selected":""}${o[0]&&o[0]===o[1]?" rep_mem_only":""}" id="rep_song_${rep_hits[s]}"><div class="rep_song_row1"><div class="rep_song_title">${song[rep_hits[s]][song_idx.name]} / ${song[rep_hits[s]][song_idx.artist]}</div><div class="rep_song_nooke">${oke_gone.includes(song[rep_hits[s]][song_idx.name])?"オケ消滅":""}</div></div><div class="rep_song_info grid_block-4"><div>${a===0?"今日":a===-1?"---":`${a}日前`}</div><div>${o[0]}回${o[1]>0?o[0]===o[1]?" (メン限のみ)":` (${o[1]}回メン限)`:""}</div><div>${rep_info.date?"("+i.toISOString().slice(0,10)+")":""}</div>${r}</div></div>`;$("#rep_display").append(c)}rep_loading_progress+=20,rep_loading_progress>=rep_hits.length&&(clearInterval(rep_display_inter),$("#rep_display").append('<div class="general_vertical_space"></div>'))}function update_rep_sort_display(){let e="";switch(settings.rep_sort_method.value){case"50":e=settings.rep_sort_asd.value?"正順 (⇌逆順)":"逆順 (⇌正順)";break;case"count":e=settings.rep_sort_asd.value?"多い順 (⇌少ない順)":"少ない順 (⇌多い順)";break;case"date":case"release":e=settings.rep_sort_asd.value?"新しい順 (⇌古い順)":"古い順 (⇌新しい順)";break;default:return 1}$("#filter_asd div:nth-child(2)").html(e)}